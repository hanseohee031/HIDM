{% extends "base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/update_interests.css' %}">
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.category .toggle').forEach(btn => {
      btn.addEventListener('click', () => {
        const group = btn.closest('.category');
        group.classList.toggle('open');
        const list = group.querySelector('.interests-list');
        list.style.display = list.style.display === 'none' ? 'block' : 'none';
        btn.textContent = btn.textContent.endsWith('▼')
          ? btn.textContent.replace('▼', '▲')
          : btn.textContent.replace('▲', '▼');
      });
    });
  });
</script>

<div class="container mt-4">
  <h2>{{ title }}</h2>
  <form method="post" novalidate>
    {% csrf_token %}
    {{ form.non_field_errors }}

    {% for category, items in grouped_interests.items %}
      <div class="category mb-3">
        <h3 class="toggle">{{ category }} ▼</h3>
        <div class="interests-list" style="display:none; padding-left:1rem;">
          {% for interest in items %}
            <div class="form-check">
              <input class="form-check-input" type="checkbox"
                     id="interest_{{ interest.pk }}"
                     name="interests"
                     value="{{ interest.pk }}"
                     {% if interest.pk|stringformat:"s" in form.interests.value %}checked{% endif %}>
              <label class="form-check-label" for="interest_{{ interest.pk }}">
                {{ interest.name }}
              </label>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}

    <button type="submit" class="btn btn-success">Save</button>
    <a href="{% url 'profile' %}" class="btn btn-secondary ms-2">Cancel</a>
  </form>
</div>
{% endblock %}
