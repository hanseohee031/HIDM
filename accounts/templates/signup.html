{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sign Up</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Style -->
  <link rel="stylesheet" href="{% static 'css/signup.css' %}?v=2">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

  <!-- jQuery Î®ºÏ†Ä -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Select2 (jQuery Îã§ÏùåÏóê!) -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

</head>


<body>
  <div class="auth-container">
    <div class="auth-card">
      <h2>Sign Up</h2>

      <form method="post" id="signup-form">
        {% csrf_token %}

        <div class="input-group-inline">
          <input type="text" name="student_id" placeholder="Student ID Number" required>
          <button type="button" id="send-verification" class="small-button">Send Code</button>
        </div>

        <div class="input-group">
          <input type="text" name="email_code" placeholder="Enter verification code" required>
          <span id="verification-result"></span>
        </div>

        <div class="input-group">
          <input type="password" name="password1" placeholder="Password" required>
        </div>

        <div class="input-group">
          <input type="password" name="password2" placeholder="Confirm Password" required>
          <small id="password-match-message" style="color: red;"></small>
        </div>

        <div class="input-group">
          <input type="text" name="nickname" placeholder="Nickname" required>
        </div>

        <div class="input-group radio-group">
          <label><input type="radio" name="gender" value="M" required> Male</label>
          <label><input type="radio" name="gender" value="F"> Female</label>
        </div>

        <div class="input-group">
          <select name="native_language" id="native_language_select" required>
            <option value="">Select your native language</option>
            <option value="en">English</option>
            <option value="ko">Korean</option>
            <option value="zh">Chinese</option>
            <option value="ja">Japanese</option>
            <option value="es">Spanish</option>
            <option value="fr">French</option>
            <option value="de">German</option>
            <option value="ru">Russian</option>
            <option value="ar">Arabic</option>
            <option value="pt">Portuguese</option>
            <option value="it">Italian</option>
            <option value="nl">Dutch</option>
            <option value="pl">Polish</option>
            <option value="sv">Swedish</option>
            <option value="no">Norwegian</option>
            <option value="tr">Turkish</option>
            <option value="th">Thai</option>
            <option value="vi">Vietnamese</option>
            <option value="id">Indonesian</option>
            <option value="hi">Hindi</option>
            <option value="ms">Malay</option>
            <option value="fi">Finnish</option>
            <option value="el">Greek</option>
            <option value="cs">Czech</option>
            <option value="hu">Hungarian</option>
            <option value="ro">Romanian</option>
            <option value="uk">Ukrainian</option>
            <option value="bg">Bulgarian</option>
            <option value="sk">Slovak</option>
            <option value="da">Danish</option>
            <option value="he">Hebrew</option>
            <option value="fa">Persian</option>
            <option value="sr">Serbian</option>
            <option value="hr">Croatian</option>
            <option value="lt">Lithuanian</option>
            <option value="lv">Latvian</option>
            <option value="et">Estonian</option>
            <option value="sl">Slovene</option>
            <option value="ca">Catalan</option>
            <option value="gl">Galician</option>
            <option value="eu">Basque</option>
            <option value="is">Icelandic</option>
            <option value="af">Afrikaans</option>
            <option value="sw">Swahili</option>
            <option value="zu">Zulu</option>
            <option value="xh">Xhosa</option>
            <option value="mt">Maltese</option>
            <option value="sq">Albanian</option>
            <option value="az">Azerbaijani</option>
            <option value="bn">Bengali</option>
            <option value="bs">Bosnian</option>
            <option value="hy">Armenian</option>
            <option value="be">Belarusian</option>
            <option value="ur">Urdu</option>
            <option value="ta">Tamil</option>
            <option value="te">Telugu</option>
            <option value="kn">Kannada</option>
            <option value="ml">Malayalam</option>
            <option value="mr">Marathi</option>
            <option value="pa">Punjabi</option>
            <option value="gu">Gujarati</option>
            <option value="si">Sinhala</option>
            <option value="km">Khmer</option>
            <option value="lo">Lao</option>
            <option value="mn">Mongolian</option>
            <option value="ka">Georgian</option>
            <option value="tg">Tajik</option>
            <option value="uz">Uzbek</option>
            <option value="ky">Kyrgyz</option>
            <option value="tk">Turkmen</option>
            <option value="ne">Nepali</option>
            <option value="ps">Pashto</option>
            <option value="so">Somali</option>
            <option value="am">Amharic</option>
            <option value="my">Burmese</option>
            <option value="yo">Yoruba</option>
            <option value="ig">Igbo</option>
            <option value="om">Oromo</option>
            <option value="ha">Hausa</option>
            <option value="rw">Kinyarwanda</option>
            <option value="mg">Malagasy</option>
            <option value="ss">Swati</option>
            <option value="st">Southern Sotho</option>
            <option value="tn">Tswana</option>
            <option value="ts">Tsonga</option>
            <option value="ve">Venda</option>
            <option value="wo">Wolof</option>
            <option value="fy">Western Frisian</option>
            <option value="fo">Faroese</option>
            <option value="kw">Cornish</option>
            <option value="ga">Irish</option>
            <option value="cy">Welsh</option>
            <option value="gd">Scottish Gaelic</option>
            <option value="br">Breton</option>
            <option value="co">Corsican</option>
            <option value="rm">Romansh</option>
            <option value="lb">Luxembourgish</option>
            <option value="mk">Macedonian</option>
            <option value="ab">Abkhazian</option>
            <option value="os">Ossetian</option>
            <option value="ba">Bashkir</option>
            <option value="ce">Chechen</option>
            <option value="cv">Chuvash</option>
            <option value="av">Avaric</option>
            <option value="tt">Tatar</option>
            <option value="ch">Chamorro</option>
            <option value="cr">Cree</option>
            <option value="iu">Inuktitut</option>
            <option value="nr">South Ndebele</option>
            <option value="nd">North Ndebele</option>
            <option value="ss">Swati</option>
            <option value="tn">Tswana</option>
            <option value="ts">Tsonga</option>
            <option value="za">Zhuang</option>
          </select>
        </div>

        <button type="submit" class="auth-button">Sign Up</button>
      </form>

      <div class="auth-link">
        <a href="{% url 'login' %}">Go to Login</a>
      </div>
    </div>
  </div>


<script>
document.getElementById('send-verification').onclick = function () {
  const id = document.querySelector('input[name="student_id"]').value.trim();
  const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
  const result = document.getElementById('verification-result');

  if (!id) {
    alert('Please enter your Student ID Number.');
    return;
  }

  // üëâ Í∏∞Îã§Î¶¨Îäî Ï§ë Î©îÏãúÏßÄ Ï∂îÍ∞Ä
  result.innerHTML = 'Sending verification code...';
  result.style.color = 'gray';

  fetch('/accounts/send-verification-code/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
      'X-CSRFToken': csrftoken,
    },
    body: 'student_id=' + encodeURIComponent(id)
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      result.innerHTML = 'Code sent ‚úîÔ∏è';
      result.style.color = 'green';
    } else {
      result.innerHTML = 'Verification failed';
      result.style.color = 'red';
    }
  })
  .catch(() => {
    result.innerHTML = 'Error occurred';
    result.style.color = 'red';
  });
};


// Ïù¥Î©îÏùº ÏΩîÎìú Ïã§ÏãúÍ∞Ñ ÌôïÏù∏
document.querySelector('input[name="email_code"]').addEventListener('input', function () {
  const code = this.value.trim();
  const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
  const result = document.getElementById('verification-result');

  if (!code) {
    result.innerHTML = '';
    return;
  }

  fetch('/accounts/verify-code/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
      'X-CSRFToken': csrftoken,
    },
    body: 'code=' + encodeURIComponent(code)
  })
  .then(response => response.json())
  .then(data => {
    if (data.valid) {
      result.innerHTML = '‚úî Code is valid';
      result.style.color = 'green';
    } else {
      result.innerHTML = '‚ùå Code is incorrect';
      result.style.color = 'red';
    }
  })
  .catch(() => {
    result.innerHTML = '‚ö† Error validating code';
    result.style.color = 'red';
  });
});


// ÎπÑÎ∞ÄÎ≤àÌò∏ ÏùºÏπò Ïó¨Î∂Ä ÌôïÏù∏
const pw1 = document.querySelector('input[name="password1"]');
const pw2 = document.querySelector('input[name="password2"]');
const pwMessage = document.getElementById('password-match-message');

pw2.addEventListener('input', function () {
  if (!pw1.value || !pw2.value) {
    pwMessage.textContent = '';
    return;
  }
  if (pw1.value === pw2.value) {
    pwMessage.textContent = '‚úî Passwords match';
    pwMessage.style.color = 'green';
  } else {
    pwMessage.textContent = '‚ùå Passwords do not match';
    pwMessage.style.color = 'red';
  }
});



// ÌöåÏõêÍ∞ÄÏûÖ Ïãú Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
document.getElementById('signup-form').addEventListener('submit', function (e) {
  const pw1 = document.querySelector('input[name="password1"]').value;
  const pw2 = document.querySelector('input[name="password2"]').value;
  const code = document.querySelector('input[name="email_code"]').value;
  let message = '';

  if (!code.trim()) {
    message += 'Please enter the verification code.\n';
  }

  if (pw1 !== pw2) {
    message += 'Passwords do not match.\n';
  }

  if (message) {
    alert(message);
    e.preventDefault(); // Ï†úÏ∂ú ÎßâÍ∏∞
  }
});

</script>


</body>
</html>
